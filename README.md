# WarmHouse

# Задание 1. Анализ и планирование

### 1. Описание функциональности монолитного приложения

Монолитное приложение компании "Тёплый дом" реализует две основные функции: управление отоплением и мониторинг температуры. Вся логика работы сосредоточена в одном серверном приложении  

**Управление отоплением:**

- Пользователи могут удалённо включать и выключать отопление в доме через веб-интерфейс
- Система поддерживает отправку управляющих команд к модулям отопления (реле), установленных в домах пользователей
- Подключение модулей отопления осуществляется путём выезда специалиста компании на место подключения. Самостоятельного подключения пользователем нет

**Мониторинг температуры:**

- Пользователи могут просматривать текущую температуру в своих домах через веб-интерфейс
- Система поддерживает получение показателей температуры с датчиков, установленных в домах пользователей
- Подключение датчиков осуществляется путём выезда специалиста компании на место подключения. Самостоятельного подключения пользователем нет

### 2. Анализ архитектуры монолитного приложения

Монолитное приложение построено по классической архитектуре без выделения отдельных сервисов и компонентов  

- **Язык программирования**: Go
- **База данных**: PostgreSQL
- **Архитектура**: Монолитная, все компоненты системы (обработка запросов, бизнес-логика, работа с данными) находятся в рамках одного приложения
- **Взаимодействие**: Синхронное, запросы обрабатываются последовательно
- **Масштабируемость**: Ограничена, так как монолит сложно масштабировать по частям
- **Развертывание**: Требует остановки всего приложения

### 3. Определение доменов и границы контекстов

**Основные домены**:
- **Управление отоплением**: Работа с модулями управления отоплением (реле), установленными в домах
- **Мониторинг температуры**: Отвечает за получение и отображение в веб-интерфейсе пользователя показателей температуры от датчиков, установленных в домах
- **Управление устройствами**: Включает подключение и привязку устройств к домам пользователей
- **Управление пользователями и домами**: Отвечает за связь между пользователем и его домами

**Границы контекстов**:
- Все домены реализованы внутри одного монолитного приложения
- Используется одна общая база данных для всех доменов
- Чётких технических границ между доменами нет, всё находится в одной кодовой базе  

Таким образом, вся бизнес-логика системы сосредоточена в едином контексте монолитного приложения

### **4. Проблемы монолитного решения**

Текущее решение имеет ряд ограничений, которые препятствуют масштабированию системы и достижению бизнес-целей компании

- **Отсутствие масштабируемости**: Невозможно масштабировать частично, для увеличения производительности необходимо развертывать всё приложение целиком
- **Сложность развёртывания**: Любые изменения требуют остановки всего приложения и приводить к простоям
- **Синхронное взаимодействие**: Все запросы выполняются последовательно, что увеличивает задержки и негативно влияет на быстродействие системы
- **Невозможность самостоятельного подключения устройств**: Пользователь не может добавить новое устройство без участия специалиста
- **Жёсткая связность компонентов**: Все функции находятся в одной кодовой базе. Это усложняет развитие системы. Добавление новых функций требует значительных изменений во всём приложении

### 5. Визуализация контекста системы — диаграмма С4

[Контекстная диаграмма системы "Тёплый дом" (As-Is)](schemas/as-is/context.png)

# Задание 2. Проектирование микросервисной архитектуры

**Диаграмма контейнеров (Containers)**

[Диаграмма контейнеров системы "Тёплый дом"](schemas/to-be/container.png)

**Диаграмма компонентов (Components)**

[Device Management Service](schemas/to-be/component-device-management.png)  
[User & House Service](schemas/to-be/component-user-house.png)  
[Heating Service](schemas/to-be/component-heating.png)  
[Lighting Service](schemas/to-be/component-lighting.png)  
[Gate Service](schemas/to-be/component-gate.png)  
[Surveillance Service](schemas/to-be/component-surveillance.png)  
[Telemetry Service](schemas/to-be/component-telemetry.png)

**Диаграмма кода (Code)**

[Device Management Service](schemas/to-be/code-device-management.png)

# Задание 3. Разработка ER-диаграммы

[ER-диаграмма основных сущностей](schemas/to-be/er.png)

# Задание 4. Создание и документирование API

### 1. Тип API

Укажите, какой тип API вы будете использовать для взаимодействия микросервисов. Объясните своё решение.

### 2. Документация API

Здесь приложите ссылки на документацию API для микросервисов, которые вы спроектировали в первой части проектной работы. Для документирования используйте Swagger/OpenAPI или AsyncAPI.

# Задание 5. Работа с docker и docker-compose

Перейдите в apps.

Там находится приложение-монолит для работы с датчиками температуры. В README.md описано как запустить решение.

Вам нужно:

1) сделать простое приложение temperature-api на любом удобном для вас языке программирования, которое при запросе /temperature?location= будет отдавать рандомное значение температуры.

Locations - название комнаты, sensorId - идентификатор названия комнаты

```
	// If no location is provided, use a default based on sensor ID
	if location == "" {
		switch sensorID {
		case "1":
			location = "Living Room"
		case "2":
			location = "Bedroom"
		case "3":
			location = "Kitchen"
		default:
			location = "Unknown"
		}
	}

	// If no sensor ID is provided, generate one based on location
	if sensorID == "" {
		switch location {
		case "Living Room":
			sensorID = "1"
		case "Bedroom":
			sensorID = "2"
		case "Kitchen":
			sensorID = "3"
		default:
			sensorID = "0"
		}
	}
```

2) Приложение следует упаковать в Docker и добавить в docker-compose. Порт по умолчанию должен быть 8081

3) Кроме того для smart_home приложения требуется база данных - добавьте в docker-compose файл настройки для запуска postgres с указанием скрипта инициализации ./smart_home/init.sql

Для проверки можно использовать Postman коллекцию smarthome-api.postman_collection.json и вызвать:

- Create Sensor
- Get All Sensors

Должно при каждом вызове отображаться разное значение температуры

Ревьюер будет проверять точно так же.


